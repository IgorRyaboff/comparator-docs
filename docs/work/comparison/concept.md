# Концепция процесса сравнения данных
---
Как только в документ **Сравнение данных** поступают **две** выгрузки (из 1-й и из 2-й ИБ), документ переходит в статус "**Ожидает сравнения**". Сравнение не выполняется в момент поступления второй выгрузки из соображений производительности процесса получения выгрузок данных. Сравнение данных готовых к сравнению документов выполняется по расписанию (*по умолчанию - раз в 5 минут*).

Сравнение данных по каждой из таблиц правила сравнения делится на следующие этапы:

1. **Подготовка таблиц выгрузок**. Таблицы, выгружаемые из целевых баз, не обрабатываются Мастером выгрузки данных и записываются в файл выгрузки "как есть". На этом этапе Сравнитель приводит обе исходные таблицы к виду, описанному в описании таблицы правила сравнения разработчиком правила сравнения;
2. **Преобразование реальных значений в значения сравнения**. Реальные значения (значения, прочитанные из исходной выгрузки) не используются для работы Сравнителя. Для соотнесения значений измерений, а также для сравнения значений ресурсов применяются **значения сравнения**. На данном этапе "рядом" с таблицами реальных значений создаются таблицы значений сравнения. Разработчик правила сравнения может определить произвольную логику преобразования значений отдельных полей, используя [подключаемую обработку сравнения](../../development/comp-rules/comparison-epf.md);
3. **Контроль дублирования строк**. Сравнитель проверяет таблицы значений сравнения на предмет наличия дубликатов строк по значениям измерений. При наличии дубликатов сравнение будет прервано, документ примет статус "**Проблема с данными**";
4. **Соотнесение строк**. Сравнитель производит соотнесение строк из таблицы 1-й ИБ с таблицей 2-й ИБ. Соотнесение происходит по совпадению значений всех измерений одной строки со значениями всех измерений другой строки;
5. **Сравнение ресурсов соотнесенных строк**. В соотнесенных строках теперь сравниваются значения ресурсов. Если значения всех ресурсов равны, обработка этой пары строк прекращается. Произвольная логика сравнения ресурсов и определения того, равны ли две строки, может быть определена в [подключаемой обработке сравнения](../../development/comp-rules/comparison-epf.md);
6. **Запись результата сравнения**. По окончании обхода пар соотнесенных строк Сравнитель получает таблицы с расхождениями - строками, на которые нужно обратить внимание пользователю. Эти строки записываются в текущий документ "**Сравнение данных**". На этом этапе из реальных значений также формируются **представления** для вывода пользователю в отчете о расхождениях. Нестандартная логика преобразования реальных значений в представления может быть определена в [подключаемой обработке сравнения](../../development/comp-rules/comparison-epf.md).